<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<exportmultiplex category="Ultra_Format" ref_path="ultra_format[Internal]/storable[ultra_format]/storable[Data]">
   <string name="Definition"><![CDATA[external pospaidExt:identified_by(recType == "Pos"){
    ascii recType : terminated_by("|"),external_only;
    ascii msisdn : terminated_by("|"); 
    ascii usage : terminated_by("|"); 
    ascii region : terminated_by(0xA);  
};

external prepaidExt:identified_by(recType == "Pre"){
    ascii recType : terminated_by(","),external_only;
    ascii customerId : terminated_by(","); 
    ascii usage : terminated_by(","); 
    ascii region : terminated_by(0xA);  
};

in_map posIMap : external(pospaidExt),target_internal(pospaidTI){automatic;};
in_map preIMap : external(prepaidExt),target_internal(prepaidTI){automatic;};

decoder prePosDec : in_map(posIMap),in_map(preIMap);

internal postpaidIntermediate {
    string msisdn;
    string usage;
    string planType;          
    double taxAmount;
    string billingCycle;
};

internal prepaidIntermediate {
    string customerId;
    double usage;
    string serviceName;
    double bonusAmount;
    string rechargeType;
};


internal CommonUsage {
    string identifier;        // msisdn or customerId
    string connectionType;    // POSTPAID / PREPAID
    string usage;
    string amountBeforeTax; // same as usage, for clarity
    double taxAmount;       // applicable for postpaid
    double bonusAmount;     // applicable for prepaid
    string finalAmount;     // computed final charge
    string planType;          // postpaid only
    string serviceName;       // prepaid only
    string billingCycle;      // postpaid only
    string rechargeType;      // prepaid only
    string region;            // from original input
    
};]]></string>
</exportmultiplex>
